name: Build UmbrellaCheats DLL with Mono

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repo
      - uses: actions/checkout@v4

      # 2️⃣ Install unzip and Mono
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip mono-complete

      # 3️⃣ Download BepInEx 5.4.23.4
      - name: Download BepInEx
        run: |
          wget https://github.com/BepInEx/BepInEx/releases/download/v5.4.23.4/BepInEx_win_x64_5.4.23.4.zip
          unzip BepInEx_win_x64_5.4.23.4.zip -d bepinex

      # 4️⃣ Compile UmbrellaCheats.cs with Mono (correct paths)
      - name: Build DLL with Mono
        run: |
          mkdir -p build
          mcs -target:library -out:build/UmbrellaCheats.dll \
            -reference:bepinex/BepInEx/core/BepInEx.dll \
            -reference:bepinex/BepInEx/core/0Harmony.dll \
            -reference:bepinex/BepInEx/core/UnityEngine.dll \
            -reference:bepinex/BepInEx/core/UnityEngine.CoreModule.dll \
            -reference:bepinex/BepInEx/core/UnityEngine.PhysicsModule.dll \
            -reference:bepinex/BepInEx/core/UnityEngine.AnimationModule.dll \
            -reference:bepinex/BepInEx/core/UnityEngine.InputLegacyModule.dll \
            UmbrellaCheats.cs

      # 5️⃣ Upload the DLL artifact
      - name: Upload DLL
        uses: actions/upload-artifact@v4
        with:
          name: UmbrellaCheats
          path: build/UmbrellaCheats.dll
